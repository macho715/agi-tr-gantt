---
description: "QA-GATES — 검증 게이트 및 테스트 규칙"
globs: ["**/*"]
alwaysApply: false
---

## 6.8 QA 게이트 (필수 체크)

### UI/UX 검증
- [ ] 동일 날짜/기간 ResourceTag 충돌 시: "충돌 수 + 영향 TR Unit"이 표시되는가
- [ ] Drilldown 체크 상태가 새로고침 후 유지되는가 (localStorage)
- [ ] 축소 화면에서도 MilestoneChip 탭이 가능한가
- [ ] 누락 마일스톤 탐지 결과가 "경고"로 표시되는가 (자동 보정 금지)

### 데이터 무결성 검증
- [ ] `DocItem.applies_to.milestone_id`가 tasks에 존재하는가
- [ ] `DeadlineRule.anchor_milestone_id`가 tasks에 존재하는가
- [ ] 동일 (voyage_id, doc_id) 중복이 없는가

### 계산 로직 검증
- [ ] 모든 계산 함수가 순수 함수인가 (부작용 없음)
- [ ] UI 컴포넌트에 계산 로직이 포함되어 있지 않은가
- [ ] 날짜 파싱/타임존이 유틸 내부에서만 표준화되는가

---

## 7 테스트/검증 규칙

### 테스트 프레임워크 확정 규칙
- **추측 금지**: `package.json` 기반으로 확인 후 작성
- 테스트 스크립트가 없으면 **Ask-first**로 추가 제안

### 최소 테스트 요구
- 핵심 유틸 (날짜/마감 계산, 스키마 검증)은 **단위 테스트 대상**
- UI는 스냅샷 남발 금지 (변경 비용 큼)

### 검증 파이프라인 순서
1. `install` (PM 확정 후)
2. `lint` (스크립트 존재 시)
3. `typecheck` (스크립트 존재 시)
4. `test` (스크립트 존재 시)
5. `build` (최종 확인)

### Safety & Permissions

**허용 (Ask-free)**
- 파일 읽기/검색/리팩토링 (동작 동일)
- 컴포넌트 분리, 타입 개선, dead code 제거
- 로컬 범위의 lint/typecheck/test 실행

**사전 승인 필요 (Ask-first)**
- 신규 패키지 설치/버전 업
- 폴더 대규모 이동/삭제
- 빌드 파이프라인/CI 설정 변경
- 전역 테마(`globals.css`)의 컬러 시스템 변경
- DB 도입/외부 서비스 연동

---

## 10 "막혔을 때" 기본 절차

1. 관련 파일 **3개 이내**로 범위를 좁혀 원인 지점 특정
2. **최소 변경**으로 우회/해결 (핫픽스)
3. 이후 구조 개선(리팩토링)은 **별 PR/별 커밋**으로 분리
