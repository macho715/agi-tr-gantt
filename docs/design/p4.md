([Past chat][1])([Past chat][2])([Past chat][3])([Past chat][4])([Past chat][5])

## Exec (DeadlineLadder ì˜¤ë²„ë ˆì´ íŒ¨ì¹˜: GanttPreview ì˜µì…˜ ì»´í¬ë„ŒíŠ¸)

* `components/gantt-preview.tsx`ì˜ **Gantt Chart íƒ­(íƒ€ì„ë¼ì¸ í—¤ë” + ë°” ì˜ì—­)** ì— â€œë¬¸ì„œ ë§ˆê° ì„¸ë¡œì„ â€ì„ **ì˜µì…˜ ì˜¤ë²„ë ˆì´ ë ˆì´ì–´**ë¡œ ì¶”ê°€í•©ë‹ˆë‹¤. (ìŠ¤í¬ë¡¤ ë™ê¸°í™”/ì¤Œ/ì£¼ë§ í•˜ì´ë¼ì´íŠ¸ êµ¬ì¡° ìœ ì§€)
* ì˜¤ë²„ë ˆì´ëŠ” **Right Panelì˜ ë™ì¼ ì¢Œí‘œê³„(=timelineWidth, cellWidth)** ë¥¼ ì‚¬ìš©í•˜ì—¬, ë§ˆê°ì¼ì„ `x = diffDays * cellWidth` ë¡œ ì •ë ¬í•©ë‹ˆë‹¤. (ìˆ˜í‰ ìŠ¤í¬ë¡¤ ìë™ ì¶”ì¢…, í¬ì¸í„° ì´ë²¤íŠ¸ ì°¨ë‹¨)
* ì™¸ë¶€ ì˜ì¡´ ìµœì†Œí™”: ê¸°ì¡´ `date-fns` ì‚¬ìš©. ë§ˆì»¤ ë°ì´í„°ëŠ” `deadlineMarkers?: DeadlineMarker[]`ë¡œ ì£¼ì…(ì—†ìœ¼ë©´ ì•„ë¬´ê²ƒë„ ë Œë”ë§í•˜ì§€ ì•ŠìŒ).

---

## Visual (ë ˆì´ì–´ êµ¬ì¡°)

```mermaid
flowchart TB
  A["GanttPreview > Gantt Chart Tab"] --> B["Timeline Header (Month/Day Rows)"]
  A --> C["Right Panel Scroll Area (Bars)"]

  B --> B1["TimelineContent (relative)"]
  B1 --> O1["DeadlineLadderOverlay (Header) - absolute, pointer-events-none"]

  C --> C1["BarsContent (relative) width=timelineWidth"]
  C1 --> O2["DeadlineLadderOverlay (Body) - absolute, pointer-events-none"]
  C1 --> W["Weekend Highlight Layer (existing)"]
  C1 --> G["Gantt Bars Layer (existing)"]
```

---

# PATCH 1) ìƒˆ ì»´í¬ë„ŒíŠ¸ ì¶”ê°€

## `components/overlays/deadline-ladder-overlay.tsx`

```tsx
"use client";

import * as React from "react";
import { differenceInCalendarDays, startOfDay } from "date-fns";

export type DeadlineRisk = "ON_TRACK" | "AT_RISK" | "OVERDUE" | "UNKNOWN";

export type DeadlineMarker = {
  id: string;
  date: Date;              // dueAt
  label: string;           // ë¬¸ì„œëª…/íŒ¨í‚¤ì§€ëª…
  risk?: DeadlineRisk;     // ìƒ‰/ìŠ¤íƒ€ì¼ìš©
  category?: string;       // PTW/NOC ë“±
};

function clamp(n: number, min: number, max: number) {
  return Math.max(min, Math.min(max, n));
}

function xOfDate(opts: { timelineStart: Date; date: Date; cellWidth: number; totalDays: number }) {
  const start = startOfDay(opts.timelineStart);
  const d = startOfDay(opts.date);
  const diff = differenceInCalendarDays(d, start);
  const idx = clamp(diff, 0, Math.max(0, opts.totalDays - 1));
  return idx * opts.cellWidth;
}

function lineClass(risk: DeadlineRisk) {
  // ê¸°ì¡´ Risk Badge í†¤ì„ ë”°ë¥´ë˜, ì˜¤ë²„ë ˆì´ê°€ ê³¼í•˜ê²Œ íŠ€ì§€ ì•Šê²Œ íˆ¬ëª…ë„ ì ìš©
  // ìƒ‰ìƒì€ Tailwind token ê¸°ë°˜(ë‹¤í¬ëª¨ë“œ í¬í•¨)
  switch (risk) {
    case "OVERDUE":
      return "bg-destructive/70";
    case "AT_RISK":
      return "bg-amber-500/60";
    case "ON_TRACK":
      return "bg-emerald-500/40";
    default:
      return "bg-muted-foreground/30";
  }
}

export function DeadlineLadderOverlay(props: {
  timelineStart: Date;
  totalDays: number;
  cellWidth: number;

  // ì˜¤ë²„ë ˆì´ê°€ ê¹”ë¦´ ì˜ì—­ ë†’ì´(í—¤ë”=64px, ë°”ì˜ì—­=scrollHeight ë“±)
  heightPx: number;

  markers: DeadlineMarker[];

  // í—¤ë”ì—ì„œ ë¼ë²¨ â€œí•€â€ì„ ë³´ì—¬ì¤„ì§€ ì—¬ë¶€(ê¸°ë³¸ true)
  showPins?: boolean;

  className?: string;
}) {
  const { timelineStart, totalDays, cellWidth, heightPx, markers, showPins = true, className } = props;

  if (!markers || markers.length === 0 || totalDays <= 0 || cellWidth <= 0) return null;

  return (
    <div
      className={[
        "pointer-events-none absolute inset-0 z-20",
        className ?? "",
      ].join(" ")}
      style={{ height: `${heightPx}px` }}
    >
      {markers.map((m) => {
        const x = xOfDate({ timelineStart, date: m.date, cellWidth, totalDays });
        const risk = m.risk ?? "UNKNOWN";

        return (
          <div key={m.id} className="absolute top-0" style={{ left: `${x}px`, height: "100%" }}>
            {/* ì„¸ë¡œì„  */}
            <div className={["w-px h-full", lineClass(risk)].join(" ")} />

            {/* í—¤ë” í•€(ì„ íƒ) */}
            {showPins && (
              <div
                className="absolute -top-0.5 left-0 translate-x-[-50%] rounded-sm px-1 py-0.5 text-[9px] leading-none"
                style={{ background: "rgba(0,0,0,0.00)" }}
                title={`${m.label} | ${m.date.toISOString().slice(0, 10)} | ${risk}`}
              >
                {/* í•€ì€ í…ìŠ¤íŠ¸ ëŒ€ì‹  ì•„ì£¼ ì‘ì€ ë§ˆì»¤ë¡œë§Œ(í˜¼ì¡ ë°©ì§€) */}
                <div className={["h-2 w-2 rounded-full", lineClass(risk)].join(" ")} />
              </div>
            )}
          </div>
        );
      })}
    </div>
  );
}
```

---

# PATCH 2) (ì„ íƒ) ë§ˆì»¤ ì–´ëŒ‘í„° ìœ í‹¸ ì¶”ê°€

ë¬¸ì„œ ê³„ì‚° ê²°ê³¼(`calcDocDueDates`)ë¥¼ ì“°ëŠ” ê²½ìš°, ì•„ë˜ ìœ í‹¸ë¡œ `DeadlineMarker[]`ë¥¼ ìƒì„±í•´ `GanttPreview`ì— ì£¼ì…í•©ë‹ˆë‹¤.

## `lib/documents/to-deadline-markers.ts`

```ts
import type { DeadlineMarker } from "@/components/overlays/deadline-ladder-overlay";

type ComputedLike = {
  items: Array<{
    rule: { id: string; title: string; category?: string };
    dueAt: Date | null;
    risk: "ON_TRACK" | "AT_RISK" | "OVERDUE" | "UNKNOWN";
  }>;
  voyage?: { id: string };
};

export function toDeadlineMarkers(computed: ComputedLike | null): DeadlineMarker[] {
  if (!computed) return [];
  const voyageId = computed.voyage?.id ?? "V?";

  return computed.items
    .filter((x) => Boolean(x.dueAt))
    .map((x) => ({
      id: `${voyageId}::${x.rule.id}`,
      date: x.dueAt as Date,
      label: x.rule.title,
      risk: x.risk,
      category: x.rule.category ?? "DOC",
    }));
}
```

---

# PATCH 3) `components/gantt-preview.tsx`ì— â€œì˜µì…˜ ì˜¤ë²„ë ˆì´â€ ì‚½ì…

ì•„ë˜ íŒ¨ì¹˜ëŠ” **GanttPreviewì˜ Gantt Chart íƒ­** ë‚´ë¶€ì— ë“¤ì–´ê°‘ë‹ˆë‹¤. GanttPreviewëŠ” **íƒ€ì„ë¼ì¸ í—¤ë”/Right Panel ìŠ¤í¬ë¡¤ ë™ê¸°í™”/ì¤Œ(cellWidth)/timelineDays/ì´ì¼ìˆ˜(totalDays)** ë¥¼ ì´ë¯¸ ê°–ê³  ìˆëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.

## 3-1) Props í™•ì¥(ì˜µì…˜ ì£¼ì…)

`GanttPreviewProps`ì— ì•„ë˜ 2ê°œ ì˜µì…˜ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

```tsx
// (ì¶”ê°€) ìƒë‹¨ import
import { DeadlineLadderOverlay, type DeadlineMarker } from "@/components/overlays/deadline-ladder-overlay";

// (ê¸°ì¡´ Propsì— ì¶”ê°€)
interface GanttPreviewProps {
  scheduleData: ScheduleData | null;
  config: ProjectConfig;
  isGenerating: boolean;

  // (ì¶”ê°€) ì˜¤ë²„ë ˆì´ ì…ë ¥
  deadlineMarkers?: DeadlineMarker[];
  defaultShowDeadlines?: boolean;
}
```

## 3-2) í—¤ë”(ë²„íŠ¼ ì˜ì—­)ì— í† ê¸€ ì¶”ê°€

GanttPreview Header(Zoom ë²„íŠ¼/Badge ìˆëŠ” ë¼ì¸)ì— ë‹¤ìŒ ìƒíƒœ/ë²„íŠ¼ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

```tsx
const [showDeadlines, setShowDeadlines] = React.useState<boolean>(defaultShowDeadlines ?? true);
```

ë²„íŠ¼(ë˜ëŠ” Switch) ì¶”ê°€:

```tsx
<Button
  variant={showDeadlines ? "default" : "outline"}
  size="sm"
  className="h-7 text-xs"
  onClick={() => setShowDeadlines((v) => !v)}
>
  Deadlines
</Button>
```

## 3-3) â€œíƒ€ì„ë¼ì¸ í—¤ë”â€ ì˜¤ë²„ë ˆì´ ì‚½ì…

íƒ€ì„ë¼ì¸ í—¤ë”(ì›”/ì¼ row)ì—ì„œ **ê°€ë¡œ ê¸°ì¤€ì **ì´ ë˜ëŠ” â€œê¸´ ì½˜í…ì¸  ì»¨í…Œì´ë„ˆ(width=timelineWidth)â€ë¥¼ `relative`ë¡œ ê°ì‹¸ê³ , ê·¸ ì•ˆì— í—¤ë”ìš© ì˜¤ë²„ë ˆì´ë¥¼ ë„£ìŠµë‹ˆë‹¤.

ì˜ˆì‹œ(ì‚½ì… íŒ¨í„´):

```tsx
// ê°€ì •: timelineStartDate, totalDays, cellWidth(ì¤Œ), timelineWidthê°€ ì´ë¯¸ ê³„ì‚°ë˜ì–´ ìˆìŒ
// ê°€ì •: Timeline Header ë†’ì´ = 64px(h-16) :contentReference[oaicite:3]{index=3}

<div className="relative" style={{ width: `${timelineWidth}px` }}>
  {/* (ê¸°ì¡´) Month Row / Day Row ë Œë” */}

  {showDeadlines && (deadlineMarkers?.length ?? 0) > 0 && (
    <DeadlineLadderOverlay
      timelineStart={timelineStartDate}
      totalDays={totalDays}
      cellWidth={cellWidth}
      heightPx={64}
      markers={deadlineMarkers!}
      showPins={true}
    />
  )}
</div>
```

## 3-4) â€œGantt Bars ì˜ì—­â€ ì˜¤ë²„ë ˆì´ ì‚½ì…(í•µì‹¬)

Right Panelì˜ ë°” ì˜ì—­ì€ ì„¸ë¡œ ìŠ¤í¬ë¡¤ì´ ìˆìœ¼ë¯€ë¡œ, ì˜¤ë²„ë ˆì´ ë†’ì´ë¥¼ **ì‹¤ì œ ìŠ¤í¬ë¡¤ ì½˜í…ì¸  ë†’ì´**ë¡œ ë§ì¶”ëŠ” ê²ƒì´ ì•ˆì •ì ì…ë‹ˆë‹¤.

### (a) Bars Content ref ì¶”ê°€

```tsx
const barsContentRef = React.useRef<HTMLDivElement | null>(null);
const [barsHeight, setBarsHeight] = React.useState<number>(0);

React.useLayoutEffect(() => {
  const el = barsContentRef.current;
  if (!el) return;

  const update = () => setBarsHeight(el.scrollHeight || el.clientHeight || 0);
  update();

  const ro = new ResizeObserver(() => update());
  ro.observe(el);

  return () => ro.disconnect();
}, [/* scheduleData, zoomLevel ë“± */]);
```

### (b) Bars Contentë¥¼ relative ì»¨í…Œì´ë„ˆë¡œ ë§Œë“¤ê³  ì˜¤ë²„ë ˆì´ ì‚½ì…

ê¸°ì¡´ ë°”/ì£¼ë§ ë ˆì´ì–´ê°€ ë“¤ì–´ìˆëŠ” â€œê¸´ ì½˜í…ì¸  ì»¨í…Œì´ë„ˆ(width=timelineWidth)â€ ìœ„ì¹˜ì— ì•„ë˜ í˜•íƒœë¡œ ê°ìŒ‰ë‹ˆë‹¤.

```tsx
<div
  ref={barsContentRef}
  className="relative"
  style={{ width: `${timelineWidth}px` }}
>
  {/* (ì¶”ê°€) Body ì˜¤ë²„ë ˆì´ */}
  {showDeadlines && (deadlineMarkers?.length ?? 0) > 0 && barsHeight > 0 && (
    <DeadlineLadderOverlay
      timelineStart={timelineStartDate}
      totalDays={totalDays}
      cellWidth={cellWidth}
      heightPx={barsHeight}
      markers={deadlineMarkers!}
      showPins={false}   // ë°” ì˜ì—­ì€ í•€ ì œê±°(í˜¼ì¡ ë°©ì§€)
    />
  )}

  {/* (ê¸°ì¡´) ì£¼ë§ í•˜ì´ë¼ì´íŠ¸ ë ˆì´ì–´ */}
  {/* (ê¸°ì¡´) Gantt Bars ë ˆì´ì–´ */}
</div>
```

> ì´ ë°©ì‹ì´ë©´ **ìˆ˜í‰ ìŠ¤í¬ë¡¤ì€ ìë™ìœ¼ë¡œ ì¼ì¹˜**í•©ë‹ˆë‹¤(ì˜¤ë²„ë ˆì´ê°€ ê°™ì€ â€œê¸´ ì½˜í…ì¸ â€ ë‚´ë¶€ì— ì¡´ì¬). ë˜í•œ `pointer-events-none`ë¡œ í´ë¦­/íˆ´íŒ ê°„ì„­ì„ ì°¨ë‹¨í•©ë‹ˆë‹¤.

---

# PATCH 4) ì‹¤ì œ ì£¼ì… ìœ„ì¹˜(ì˜ˆ: í†µí•© Provider ê¸°ì¤€)

ë¬¸ì„œ ê³„ì‚°ì„ ì´ë¯¸ ë¶™ì¸ êµ¬ì¡°ë¼ë©´, `computed â†’ deadlineMarkers` ë³€í™˜ í›„ `GanttPreview`ì— ë„˜ê¸°ë©´ ëì…ë‹ˆë‹¤.

ì˜ˆì‹œ:

```tsx
import { toDeadlineMarkers } from "@/lib/documents/to-deadline-markers";

const markers = React.useMemo(() => toDeadlineMarkers(computed), [computed]);

<GanttPreview
  scheduleData={scheduleData}
  config={config}
  isGenerating={isGenerating}
  deadlineMarkers={markers}
  defaultShowDeadlines={true}
/>
```

---

## QA (ì¦‰ì‹œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤)

1. **ì¤Œ 4ë‹¨ê³„ ë³€ê²½** ì‹œ ì„¸ë¡œì„ ì´ ë‚ ì§œ ê·¸ë¦¬ë“œì— ê³„ì† ì •ë ¬ë˜ëŠ”ê°€(=cellWidth ë™ê¸°)
2. **ìˆ˜í‰ ìŠ¤í¬ë¡¤** ì‹œ í—¤ë”/ë°” ì˜ì—­ ì„¸ë¡œì„  ìœ„ì¹˜ê°€ ë™ì¼í•˜ê²Œ ì´ë™í•˜ëŠ”ê°€(=ê°™ì€ width ì»¨í…Œì´ë„ˆ ë‚´ë¶€)
3. **ì„¸ë¡œ ìŠ¤í¬ë¡¤** ì‹œ ì„¸ë¡œì„ ì´ ë°” ì˜ì—­ ì „ì²´(ìŠ¤í¬ë¡¤ ì½˜í…ì¸  ë†’ì´)ë¡œ ìœ ì§€ë˜ëŠ”ê°€
4. **íˆ´íŒ/í´ë¦­**(ë°” hover) ë™ì‘ì´ ì˜¤ë²„ë ˆì´ë¡œ ì¸í•´ ë°©í•´ë°›ì§€ ì•ŠëŠ”ê°€(`pointer-events-none`)

---

## ğŸ”§ cmd 3 (Now/Next/Alt)

* Now: `DeadlineLadderOverlay` ì¶”ê°€ + `gantt-preview.tsx`ì— í—¤ë”/ë°” ì˜ì—­ 2ì¤‘ ì˜¤ë²„ë ˆì´ ì‚½ì…
* Next: â€œë§ˆê° ë¼ë²¨ í•„í„°(PTW/NOC/OTHER)â€ + â€œOverdueë§Œ í‘œì‹œâ€ í† ê¸€
* Alt: Gantt ë°” í´ë¦­ ì‹œ ìš°ì¸¡ íŒ¨ë„ì— â€œí•´ë‹¹ Activity/Voyage ë¬¸ì„œë§Œâ€ í•„í„°ë§(dual highlight)

---

## ZERO log

| ë‹¨ê³„ | ì´ìœ                                                                                             | ìœ„í—˜ | ìš”ì²­ë°ì´í„°                                     | ë‹¤ìŒì¡°ì¹˜                         |
| -- | --------------------------------------------------------------------------------------------- | -- | ----------------------------------------- | ---------------------------- |
| ê³„ì† | ì‹¤ì œ `gantt-preview.tsx` ë‚´ë¶€ ë³€ìˆ˜ëª…(`timelineStartDate`, `timelineWidth`, `cellWidth`)ì´ ë¬¸ì„œì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ | ë‚®ìŒ | (í•„ìš” ì‹œ) gantt-preview.tsx í•´ë‹¹ êµ¬ê°„ ì½”ë“œ 50~100ì¤„ | ë³€ìˆ˜ëª…ì— ë§ì¶° ì‚½ì… ìœ„ì¹˜ë¥¼ ì •í™•í•œ diffë¡œ ì¬ì‘ì„± |

ì›í•˜ì‹œë©´, ë‹¤ìŒ ë©”ì‹œì§€ì—ì„œ `components/gantt-preview.tsx`ì˜ ì‹¤ì œ ì½”ë“œ ì¼ë¶€(íƒ€ì„ë¼ì¸ í—¤ë”/ë°” ë Œë” êµ¬ê°„)ë§Œ ë¶™ì—¬ì£¼ì‹œë©´, ìœ„ íŒ¨ì¹˜ë¥¼ **ì •í™•í•œ diff í˜•ì‹(ì‚­ì œ/ì¶”ê°€ ë¼ì¸ í¬í•¨)** ìœ¼ë¡œ â€œê·¸ëŒ€ë¡œ ì ìš© ê°€ëŠ¥í•œâ€ íŒ¨ì¹˜ë¡œ ë‹¤ì‹œ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.

[1]: https://chatgpt.com/c/696e5fe6-6364-832c-a3be-20751920a2a0 "ëŒ€ì‹œë³´ë“œ í†µí•© ì•„ì´ë””ì–´"
[2]: https://chatgpt.com/c/696e6070-ac70-8330-a939-846e580eda98 "New chat"
[3]: https://chatgpt.com/c/695bbe6a-6728-832b-a65f-f5d9e1af400d "Prompt List HVDC Logistics"
[4]: https://chatgpt.com/c/696e5d18-6704-832d-be15-cc890e40ccbe "Vercel Next.js AGI Gantt"
[5]: https://chatgpt.com/c/696bc1a1-2cd8-832a-951c-7cab39495bdf "Conversation summary"
